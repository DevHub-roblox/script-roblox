--// ThaiHub / TestHub - Strong Aim + FOV (Gunfight Arena)

getgenv().ThaiHubAim = {
    Enabled = false,
    Radius = 200,       -- FOV size
    MaxDistance = 500,
    Smoothness = 1,     -- 1 = lock cá»©ng
    AimPart = "Head",
    ShowFOV = true
}

--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

--// UI Button (Drag)
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "ThaiHub_TestHub"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0,150,0,45)
frame.Position = UDim2.new(0.5,-75,0.8,0)
frame.BackgroundColor3 = Color3.fromRGB(15,15,15)
frame.Active = true
frame.Draggable = true
frame.BorderSizePixel = 0
Instance.new("UICorner", frame).CornerRadius = UDim.new(0,12)

local btn = Instance.new("TextButton", frame)
btn.Size = UDim2.new(1,0,1,0)
btn.BackgroundTransparency = 1
btn.Font = Enum.Font.GothamBold
btn.TextSize = 14
btn.TextColor3 = Color3.new(1,1,1)
btn.Text = "ðŸŽ¯ ThaiHub AIM : OFF"

btn.MouseButton1Click:Connect(function()
    ThaiHubAim.Enabled = not ThaiHubAim.Enabled
    btn.Text = ThaiHubAim.Enabled and "ðŸŽ¯ ThaiHub AIM : ON" or "ðŸŽ¯ ThaiHub AIM : OFF"
end)

--// FOV Circle
local fov = Drawing.new("Circle")
fov.Color = Color3.fromRGB(255, 0, 0)
fov.Thickness = 2
fov.Filled = false
fov.NumSides = 100
fov.Visible = false

--// Target Lock
local LockedTarget = nil

local function GetTarget()
    local closest, shortest = nil, ThaiHubAim.Radius

    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild(ThaiHubAim.AimPart) then
            local hum = plr.Character:FindFirstChildOfClass("Humanoid")
            if hum and hum.Health > 0 then
                local part = plr.Character[ThaiHubAim.AimPart]
                local pos, vis = Camera:WorldToViewportPoint(part.Position)
                if vis then
                    local mousePos = UIS:GetMouseLocation()
                    local dist2D = (Vector2.new(pos.X,pos.Y) - mousePos).Magnitude
                    local dist3D = (part.Position - Camera.CFrame.Position).Magnitude

                    if dist2D < shortest and dist3D <= ThaiHubAim.MaxDistance then
                        shortest = dist2D
                        closest = part
                    end
                end
            end
        end
    end
    return closest
end

--// Loop
RunService.RenderStepped:Connect(function()
    local mousePos = UIS:GetMouseLocation()

    -- FOV update
    fov.Position = mousePos
    fov.Radius = ThaiHubAim.Radius
    fov.Visible = ThaiHubAim.Enabled and ThaiHubAim.ShowFOV

    if not ThaiHubAim.Enabled then
        LockedTarget = nil
        return
    end

    if not LockedTarget or not LockedTarget.Parent then
        LockedTarget = GetTarget()
    end

    if LockedTarget then
        local hum = LockedTarget.Parent:FindFirstChildOfClass("Humanoid")
        if not hum or hum.Health <= 0 then
            LockedTarget = nil
            return
        end

        local camPos = Camera.CFrame.Position
        local targetPos = LockedTarget.Position
        local newCF = CFrame.new(camPos, targetPos)

        if ThaiHubAim.Smoothness >= 1 then
            Camera.CFrame = newCF
        else
            Camera.CFrame = Camera.CFrame:Lerp(newCF, ThaiHubAim.Smoothness)
        end
    end
end)
